<!DOCTYPE html>
{% load static %}
{% load redirect_tag %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Catalog Index</title>
    <link rel="stylesheet" type="text/css" href="{% static 'catalog/index.css' %}"/>
</head>
<body>

    {% include './pagination.html' %}

    <form method="post" action="{% url 'books' %}">
        {% csrf_token %}
        {% redirect_tag %}
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Published</th>
                    <th>Publisher</th>
                    <th>Format</th>
                    <th>ISBN</th>
                </tr>
            </thead>
            <tbody>
                {% for book in page_obj %}
                <tr>
                    <td>
                        <input type="checkbox" name="book_id" value="{{ book.id }}"/>
                    </td>
                    <td>
                        <span class="book-title">
                            <a href="{% url 'show_book' book.id %}">{{ book.title }}</a>
                        </span>
                        {% if book.subtitle %}<span class="book-subtitle">{{ book.subtitle }}</span>{% endif %}

                        {% for serial in book.series_memberships %}
                        <span class="book-series"><a href="?series={{ serial.series.title|urlencode}}">{{serial.series.title}}</a> Book {{serial.order}}</span>
                        {% endfor %}

                        <div class="tags">
                            {% for tag in book.plain_tags %}
                            <a href="{% url 'index' %}?tag={{ tag }}">{{ tag }}</a>
                            {% endfor %}
                        </div>
                    </td>
                    <td>
                        <ul class="book-credits">
                            {% for person in book.author %}
                            <li class="credit"><a href="?author={{ person.name|urlencode }}">{{ person.name }}</a></li>
                            {% endfor %}
                            {% for person in book.editor %}
                            <li class="credit"><a href="?editor={{ person.name|urlencode }}">{{ person.name }}</a> (Ed.)</li>
                            {% endfor %}
                            {% for person in book.illustrator %}
                            <li class="credit"><a href="?illustrator={{ person.name|urlencode }}">{{ person.name }}</a> (Illus.)</li>
                            {% endfor %}
                            {% for person in book.translator %}
                            <li class="credit"><a href="?translator={{ person.name|urlencode }}">{{ person.name }}</a> (Trans.)</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td>
                        {{ book.publication_date }}
                    </td>
                    <td>
                        {{ book.publisher }}
                    </td>
                    <td>
                        {{ book.format.capitalize }}
                    </td>
                    <td>
                        {{ book.isbn }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <input type="text" name="tag"/>
        <button name="action" value="tag">Add tag</button>
        <button name="action" value="edit">Edit selected books</button>
    </form>

    {% include './pagination.html' %}

    {% if filters %}
    <div class="filters">
        <a href="{% url 'index' %}">Clear Filters</a>
    </div>
    {% endif %}
    <div class="controls">
        <a href="{% url 'import_books' %}">Import Book Titles</a> —
        <a href="{% url 'import_by_isbn' %}">Import by ISBNs</a> —
        <form class="add-by-isbn" method="post" action="{% url 'import_by_isbn' %}">
            {% csrf_token %}
            {% redirect_tag %}
            Add by ISBN: {{ isbn_form.isbn }}
            <button>Submit</button>
        </form>
    </div>
</body>
</html>
