<!DOCTYPE html>
{% load static %}
{% load redirect_tag %}
{% load url_query %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Catalog Index</title>
    <link rel="stylesheet" type="text/css" href="{% static 'catalog/index.css' %}"/>
</head>
<body>
    <div class="controls">
        <form method="get" action="{% url 'find_book' %}">
            <input type="text" name="isbn"/>
            <button>Find by ISBN</button>
        </form>
    </div>

    {% include './pagination.html' %}

    <form method="post" action="">
        {% csrf_token %}
        <select name="filter_name">
            {% for filter_name in filter_names %}
            <option>{{ filter_name }}</option>
            {% endfor %}
        </select>
        <input type="text" name="filter_value"/>
        <button>Add filter</button>
    </form>

    {% if filters %}
    <ul class="filters">
        {% for filter in filter_removal_links %}
        <li class="filter">
            <span class="filter-label">{{ filter.label }}</span>
            <a href="{{ filter.href }}" title="Remove {{ filter.label }}">×</a>
        </li>
        {% endfor %}
        <li class="clear-filter"><a href="{% url 'index' %}">Clear All Filters</a></li>
    </ul>
    {% endif %}

    <form method="post" action="{% url 'books' %}">
        {% csrf_token %}
        {% redirect_tag %}
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Published</th>
                    <th>Publisher</th>
                    <th>Format</th>
                    <th>ISBN</th>
                </tr>
            </thead>
            <tbody>
                {% for book in page_obj %}
                <tr>
                    <td>
                        <input type="checkbox" name="book_id" value="{{ book.id }}"/>
                    </td>
                    <td>
                        <span class="book-title">
                            <a href="{% url 'show_book' book.id %}">{{ book.title }}</a>
                        </span>
                        {% if book.subtitle %}<span class="book-subtitle">{{ book.subtitle }}</span>{% endif %}

                        {% for serial in book.series_memberships %}
                        <span class="book-series"><a href="{% add_filter 'series' serial.series.title %}">{{serial.series.title}}</a> Book {{serial.order}}</span>
                        {% endfor %}

                        <div class="tags">
                            {% for tag in book.plain_tags %}
                            <a href="{% add_filter 'tag' tag %}">{{ tag }}</a>
                            {% endfor %}
                        </div>
                    </td>
                    <td>
                        <ul class="book-credits">
                            {% for person in book.author %}
                            <li class="credit"><a href="{% add_filter 'author' person.name %}">{{ person.name }}</a></li>
                            {% endfor %}
                            {% for person in book.editor %}
                            <li class="credit"><a href="{% add_filter 'editor' person.name %}">{{ person.name }}</a> (Ed.)</li>
                            {% endfor %}
                            {% for person in book.illustrator %}
                            <li class="credit"><a href="{% add_filter 'illustrator' person.name %}">{{ person.name }}</a> (Illus.)</li>
                            {% endfor %}
                            {% for person in book.translator %}
                            <li class="credit"><a href="{% add_filter 'translator' person.name %}">{{ person.name }}</a> (Trans.)</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td>
                        <a href="{% add_filter 'year' book.publication_date %}">{{ book.publication_date }}</a>
                    </td>
                    <td>
                        <a href="{% add_filter 'publisher' book.publisher %}">{{ book.publisher }}</a>
                    </td>
                    <td>
                        <a href="{% add_filter 'format' book.format %}">{{ book.format.capitalize }}</a>
                    </td>
                    <td>
                        {{ book.isbn }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="controls">
            <input type="text" name="tag"/>
            <button name="action" value="tag">Add tag</button>
            <button name="action" value="edit">Edit selected books</button>
        </div>
    </form>

    {% include './pagination.html' %}

    <div class="controls">
        <a href="{% url 'import_books' %}">Import Book Titles</a> —
        <a href="{% url 'import_by_isbn' %}">Import by ISBNs</a> —
        <form class="add-by-isbn" method="post" action="{% url 'import_by_isbn' %}">
            {% csrf_token %}
            {% redirect_tag %}
            Add by ISBN: {{ isbn_form.isbn }}
            <button>Submit</button>
        </form>
    </div>
</body>
</html>
